<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ShoppeDB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .dashboard-content {
            padding: 20px;
            background-color: #F9DFDF;
        }

        .dashboard-content .container { display: flex; flex-wrap: wrap; gap: 40px; }
        .dashboard-content .panel { border: 1px solid #ccc; padding: 20px; border-radius: 8px; background-color: #fff; min-width: 400px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .dashboard-content h1 { color: #333; }
        .dashboard-content h2 { color: #555; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
        .dashboard-content form { margin-bottom: 20px; }
        .dashboard-content input[type="number"] { padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
        .dashboard-content button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .dashboard-content button:hover { background-color: #0056b3; }
        .dashboard-content table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .dashboard-content th, .dashboard-content td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .dashboard-content th { background-color: #f2f2f2; }
        
        /* CSS cho c√°c th√¥ng b√°o (Flash Messages) */
        .dashboard-content .flash { padding: 15px; margin-bottom: 20px; border-radius: 5px; list-style: none; }
        .dashboard-content .flash.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .dashboard-content .flash.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .dashboard-content .flash.warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .dashboard-content .flash.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body class="bg-gray-50 flex flex-col h-screen relative">

    <!-- Header -->
    <header class="bg-black text-white h-12 flex items-center px-6 shrink-0">
        <nav class="flex gap-6 h-full">
            <a href="/dashboard" class="h-full flex items-center px-2 text-red-500 border-b-4 border-red-600 font-bold">Dashboard</a>
            <a href="/productManagement" class="h-full flex items-center px-2 text-gray-300 hover:text-white">Qu·∫£n l√Ω Kho</a>
            <a href="/marketplace" class="h-full flex items-center px-2 text-gray-300 hover:text-white">Th·ªã Tr∆∞·ªùng</a>
        </nav>
        <div class="ml-auto text-sm text-gray-400">
            {% if session.get('user_id') %}
                Seller #{{ session.get('user_id') }} | 
            {% endif %}
            <a href="/logout" class="text-white hover:underline">ƒêƒÉng xu·∫•t</a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto">
        <div class="dashboard-content">
            
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flash">
                {% for category, message in messages %}
                <li class="flash {{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
            {% endwith %}

            <h1>Dashboard Th·ªëng K√™ (Trang c·ªßa Leader)</h1>
            <div class="container">

                <div class="panel" id="top-sellers-panel">
                    <h2>üèÜ Top Sellers (Demo Stored Procedure)</h2>
                    <form action="/dashboard" method="POST">
                        <input type="hidden" name="form_type" value="top_sellers">
                        
                        <label for="top_n">L·∫•y Top:</label>
                        <input type="number" id="top_n" name="top_n" value="5" min="1">
                        
                        <label for="min_revenue">Doanh thu t·ªëi thi·ªÉu:</label>
                        <input type="number" id="min_revenue" name="min_revenue" value="0" min="0" step="0.01">
                        
                        <button type="submit">Xem B√°o c√°o</button>
                    </form>

                    {% if sellers %}
                        <h3>K·∫øt qu·∫£: Top Sellers</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Seller ID</th>
                                    <th>T√™n C·ª≠a h√†ng</th>
                                    <th>Doanh thu (VND)</th>
                                    <th>T·ªïng ƒë∆°n h√†ng</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for seller in sellers %}
                                <tr>
                                    <td>{{ seller.SellerID }}</td>
                                    <td>{{ seller.StoreNames }}</td>
                                    <td>{{ "{:,.0f}".format(seller.TotalRevenue) }}</td>
                                    <td>{{ seller.TotalOrders }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% endif %}
                </div>

                <div class="panel" id="warehouse-section">
                    <h2>üìú L·ªãch s·ª≠ Mua h√†ng (Demo Function + Cursor)</h2>
                    <form action="/dashboard" method="POST">
                        <input type="hidden" name="form_type" value="buyer_history">
                        
                        <label for="buyer_id">Nh·∫≠p ID Ng∆∞·ªùi mua (Buyer ID):</label>
                        <input type="number" id="buyer_id" name="buyer_id" 
                            value="{{ buyer_id if buyer_id else '' }}" placeholder="V√≠ d·ª•: 1">
                        
                        <button type="submit">Ki·ªÉm tra</button>
                    </form>

                    {% if history is not none %}
                        <h3>K·∫øt qu·∫£ cho Buyer ID {{ buyer_id }}:</h3>
                        <p>
                            <strong>C√°c s·∫£n ph·∫©m ƒë√£ mua:</strong>
                            {{ history if history else "Kh√¥ng t√¨m th·∫•y l·ªãch s·ª≠ mua h√†ng." }}
                        </p>
                    {% endif %}
                </div>
            </div>

        </div> <!-- K·∫øt th√∫c .dashboard-content -->
    </main>

</body>
</html>