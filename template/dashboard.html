<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Crusaders Logistics</title>
    <!-- Import ph√¥ng ch·ªØ Roboto t·ª´ Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- PH·∫¶N CSS T·ª™ BANNER G·ªêC --- */

        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto', sans-serif;
            /* N·ªÅn h·ªìng cho khu v·ª±c b√™n ngo√†i container 1440px (n·∫øu c√≥) */
            background-color: #F9DFDF; 
        }

        .main-container {
            position: relative;
            width: 1440px;
            height: 900px;
            /* CƒÉn gi·ªØa trang (t√πy ch·ªçn) */
            margin: 0 auto;
            overflow: hidden; /* Gi·∫•u c√°c ph·∫ßn t·ª≠ tr√†n l·ªÅ */
            /* N·ªÅn h·ªìng s·∫Ω l√† n·ªÅn c·ªßa container ch√≠nh,
               nh∆∞ng s·∫Ω b·ªã che b·ªüi .dashboard-content */
            background-color: #F9DFDF;
        }

        .header-top {
            position: absolute;
            width: 1440px;
            height: 82px;
            left: 0px;
            top: 0px;
            background: #FFFFFF;
            z-index: 10; 
        }

        .header-nav {
            position: absolute;
            width: 1440px;
            height: 67px;
            left: 0px;
            top: 83px;
            background: #000000;
            z-index: 10; 
        }

        .nav-item {
            position: absolute;
            display: block;
            text-decoration: none;
            cursor: pointer;
        }

        .nav-item-dashboard {
            width: 165px;
            height: 44px;
            left: 85px;
            top: 102px;
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 700;
            font-size: 24px;
            line-height: 28px;
            color: #F70505; 
            z-index: 11;
        }

        .nav-item-dashboard:visited,
        .nav-item-dashboard:hover,
        .nav-item-dashboard:active {
            color: #F70505;
        }
        
        .nav-item-quan-ly-kho {
            width: 138px;
            height: 41px;
            left: 329px;
            top: 103px;
            font-family: 'Roboto';
            font-style: normal;
            font-weight: 400;
            font-size: 24px;
            line-height: 28px;
            color: #FFFFFF; 
            z-index: 11;
        }

        .nav-item-quan-ly-kho:visited,
        .nav-item-quan-ly-kho:hover,
        .nav-item-quan-ly-kho:active {
            color: #FFFFFF;
        }

        .nav-active-underline {
            position: absolute;
            width: 200px;
            height: 0px;
            left: 54px;
            top: 150px;
            border: 6px solid #FF0A0A;
            transform: rotate(-0.02deg);
            z-index: 11;
        }

        /* --- V√ôNG N·ªòI DUNG DASHBOARD M·ªöI --- */
        .dashboard-content {
            position: absolute;
            top: 150px; /* Ngay d∆∞·ªõi thanh nav ƒëen (83px + 67px) */
            left: 0;
            width: 1440px;
            /* Chi·ªÅu cao = 900px (t·ªïng) - 150px (header+nav) */
            height: 750px; 
            overflow-y: auto; /* Cho ph√©p cu·ªôn n·∫øu n·ªôi dung d√†i */
            
            /* Style l·∫•y t·ª´ body c·ªßa file dashboard */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #F9DFDF; /* N·ªÅn h·ªìng nh·∫°t theo y√™u c·∫ßu */
            padding: 20px; /* Th√™m padding nh∆∞ file dashboard */
            box-sizing: border-box; /* ƒê·ªÉ padding kh√¥ng l√†m tƒÉng k√≠ch th∆∞·ªõc */
            z-index: 5; /* N·∫±m d∆∞·ªõi header/nav */
        }


        /* --- PH·∫¶N CSS T·ª™ FILE DASHBOARD --- */
        /* C√°c style n√†y gi·ªù s·∫Ω √°p d·ª•ng cho c√°c element b√™n trong .dashboard-content */

        .dashboard-content .container { display: flex; flex-wrap: wrap; gap: 40px; }
        .dashboard-content .panel { border: 1px solid #ccc; padding: 20px; border-radius: 8px; background-color: #fff; min-width: 400px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .dashboard-content h1 { color: #333; }
        .dashboard-content h2 { color: #555; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
        .dashboard-content form { margin-bottom: 20px; }
        .dashboard-content input[type="number"] { padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
        .dashboard-content button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .dashboard-content button:hover { background-color: #0056b3; }
        .dashboard-content table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .dashboard-content th, .dashboard-content td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .dashboard-content th { background-color: #f2f2f2; }
        
        /* CSS cho c√°c th√¥ng b√°o (Flash Messages) */
        .dashboard-content .flash { padding: 15px; margin-bottom: 20px; border-radius: 5px; list-style: none; }
        .dashboard-content .flash.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .dashboard-content .flash.error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .dashboard-content .flash.warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
        .dashboard-content .flash.info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }

    </style>
</head>
<body>

    <!-- Container ch√≠nh b·ªçc to√†n b·ªô trang -->
    <div class="main-container">

        <!-- Thanh header tr·∫Øng tr√™n c√πng -->
        <div class="header-top">
            <!-- N·ªôi dung b√™n trong ƒë√£ b·ªã x√≥a theo y√™u c·∫ßu -->
        </div>

        <!-- Thanh menu ƒëi·ªÅu h∆∞·ªõng m√†u ƒëen -->
        <div class="header-nav">
            <!-- Tr·ªëng, v√¨ c√°c m·ª•c menu ƒë∆∞·ª£c ƒë·ªãnh v·ªã tuy·ªát ƒë·ªëi -->
        </div>

        <!-- C√°c m·ª•c menu c·ªßa thanh m√†u ƒëen -->
        <a class="nav-item nav-item-dashboard" href="/dashboard">Dashboard</a>
        <a class="nav-item nav-item-quan-ly-kho" href="#warehouse-section">Qu·∫£n l√Ω Kho</a>
        <div class="nav-active-underline"></div>

        
        <!-- N·ªòI DUNG DASHBOARD ƒê∆Ø·ª¢C CH√àN V√ÄO ƒê√ÇY -->
        <div class="dashboard-content">
            
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flash">
                {% for category, message in messages %}
                <li class="flash {{ category }}">{{ message }}</li>
                {% endfor %}
                </ul>
            {% endif %}
            {% endwith %}

            <h1>Dashboard Th·ªëng K√™ (Trang c·ªßa Leader)</h1>
            <div class="container">

                <div class="panel" id="top-sellers-panel">
                    <h2>üèÜ Top Sellers (Demo Stored Procedure)</h2>
                    <form action="/dashboard" method="POST">
                        <input type="hidden" name="form_type" value="top_sellers">
                        
                        <label for="top_n">L·∫•y Top:</label>
                        <input type="number" id="top_n" name="top_n" value="5" min="1">
                        
                        <label for="min_revenue">Doanh thu t·ªëi thi·ªÉu:</label>
                        <input type="number" id="min_revenue" name="min_revenue" value="0" min="0" step="0.01">
                        
                        <button type="submit">Xem B√°o c√°o</button>
                    </form>

                    {% if sellers %}
                        <h3>K·∫øt qu·∫£: Top Sellers</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Seller ID</th>
                                    <th>T√™n C·ª≠a h√†ng</th>
                                    <th>Doanh thu (VND)</th>
                                    <th>T·ªïng ƒë∆°n h√†ng</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for seller in sellers %}
                                <tr>
                                    <td>{{ seller.SellerID }}</td>
                                    <td>{{ seller.StoreNames }}</td>
                                    <td>{{ "{:,.0f}".format(seller.TotalRevenue) }}</td>
                                    <td>{{ seller.TotalOrders }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    {% endif %}
                </div>

                <div class="panel" id="warehouse-section">
                    <h2>üìú L·ªãch s·ª≠ Mua h√†ng (Demo Function + Cursor)</h2>
                    <form action="/dashboard" method="POST">
                        <input type="hidden" name="form_type" value="buyer_history">
                        
                        <label for="buyer_id">Nh·∫≠p ID Ng∆∞·ªùi mua (Buyer ID):</label>
                        <input type="number" id="buyer_id" name="buyer_id" 
                            value="{{ buyer_id if buyer_id else '' }}" placeholder="V√≠ d·ª•: 1">
                        
                        <button type="submit">Ki·ªÉm tra</button>
                    </form>

                    {% if history is not none %}
                        <h3>K·∫øt qu·∫£ cho Buyer ID {{ buyer_id }}:</h3>
                        <p>
                            <strong>C√°c s·∫£n ph·∫©m ƒë√£ mua:</strong>
                            {{ history if history else "Kh√¥ng t√¨m th·∫•y l·ªãch s·ª≠ mua h√†ng." }}
                        </p>
                    {% endif %}
                </div>
            </div>

        </div> <!-- K·∫øt th√∫c .dashboard-content -->

    </div> <!-- K·∫øt th√∫c .main-container -->

</body>
</html>